# Generated by Chef for <%= @node[:fqdn] %>
#

# Configuration for <%= @mount_point %>

<% @glustersrvs.each do |glustersrv| -%>
<% shortid = glustersrv[/\A[^\.]+\./].gsub(".","") -%>
volume <%= shortid %>_<%= @mount_point %>
    type protocol/client
    option transport-type tcp
    option transport.socket.nodelay on
    option transport.remote-port 6996
    option remote-host <%= glustersrv %>
    option remote-subvolume export_<%= @mount_point %>
end-volume
<% end %>

<% @subvols = Array.new -%>
<% @glustersrvs.each do |glustersrv| -%>
<% shortid = glustersrv[/\A[^\.]+\./].gsub(".","") -%>
<% @subvols << "#{shortid}_#{@mount_point}" -%>
<% end -%>

volume mirror_<%= @mount_point %>
    type cluster/replicate
    subvolumes <%= @subvols.join(" ") %>
end-volume

volume iothreads_<%= @mount_point %>
  type performance/io-threads
  option thread-count 64  # default is 1
  subvolumes mirror_<%= @mount_point %>
end-volume

volume iocache_<%= @mount_point %>
  type performance/io-cache
  option cache-size 512MB               # default is 32MB
  option cache-timeout 60                # default is 1 second
  subvolumes iothreads_<%= @mount_point %>
end-volume

volume quickread_<%= @mount_point %>
  type performance/quick-read
  option cache-timeout 1         # default 1 second
  option max-file-size 256KB        # default 64Kb
  subvolumes iocache_<%= @mount_point %>
end-volume