# Generated by Chef for <%= @node[:fqdn] %>
#

<% @mount_points.each do |mount_point| -%>
# Configuration for <%= mount_point %>

volume dir_<%= mount_point %>
  type storage/posix
  option directory /gfs/<%= mount_point %>
end-volume

volume lock_<%= mount_point %>
    type features/locks
    subvolumes dir_<%= mount_point %>
end-volume

volume export_<%= mount_point %>
  type performance/io-threads
  option thread-count 64  # default is 1
  subvolumes lock_<%= mount_point %>
end-volume
<% end -%>

volume server-tcp
    type protocol/server
    option transport-type tcp
    option transport.socket.nodelay on 

<% @mount_points.each do |mount_point| -%>
    option auth.addr.export_<%= mount_point %>.allow *
    option volume-filename.<%= mount_point %> /etc/glusterfs/<%= mount_point %>.vol
<% end -%>

    subvolumes <% @exports.join(" ") -%>
end-volume

