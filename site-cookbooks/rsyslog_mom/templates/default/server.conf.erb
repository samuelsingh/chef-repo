# Generated by Chef. 
# Local modifications will be overwritten.
<% case @protocol -%>
<% when "tcp" -%>
$ModLoad imtcp
$InputTCPServerRun 514
<% when "udp" -%>
$ModLoad imudp
$UDPServerRun 514
<% end -%>

$DirGroup root
$DirCreateMode 0755
$FileGroup root

$template PerHostAuth,"<%= @log_dir %>/%HOSTNAME%/%$YEAR%/%$MONTH%/%$DAY%/auth.log:%HOSTNAME%:%$NOW%"
$template PerHostCron,"<%= @log_dir %>/%HOSTNAME%/%$YEAR%/%$MONTH%/%$DAY%/cron.log:%HOSTNAME%:%$NOW%"
$template PerHostSyslog,"<%= @log_dir %>/%HOSTNAME%/%$YEAR%/%$MONTH%/%$DAY%/syslog:%HOSTNAME%:%$NOW%"
$template PerHostDaemon,"<%= @log_dir %>/%HOSTNAME%/%$YEAR%/%$MONTH%/%$DAY%/daemon.log:%HOSTNAME%:%$NOW%"
$template PerHostKern,"<%= @log_dir %>/%HOSTNAME%/%$YEAR%/%$MONTH%/%$DAY%/kern.log:%HOSTNAME%:%$NOW%"
$template PerHostLpr,"<%= @log_dir %>/%HOSTNAME%/%$YEAR%/%$MONTH%/%$DAY%/lpr.log:%HOSTNAME%:%$NOW%"
$template PerHostUser,"<%= @log_dir %>/%HOSTNAME%/%$YEAR%/%$MONTH%/%$DAY%/user.log:%HOSTNAME%:%$NOW%"
$template PerHostMail,"<%= @log_dir %>/%HOSTNAME%/%$YEAR%/%$MONTH%/%$DAY%/mail.log:%HOSTNAME%:%$NOW%"
$template PerHostMailInfo,"<%= @log_dir %>/%HOSTNAME%/%$YEAR%/%$MONTH%/%$DAY%/mail.info:%HOSTNAME%:%$NOW%"
$template PerHostMailWarn,"<%= @log_dir %>/%HOSTNAME%/%$YEAR%/%$MONTH%/%$DAY%/mail.warn:%HOSTNAME%:%$NOW%"
$template PerHostMailErr,"<%= @log_dir %>/%HOSTNAME%/%$YEAR%/%$MONTH%/%$DAY%/mail.err:%HOSTNAME%:%$NOW%"
$template PerHostNewsCrit,"<%= @log_dir %>/%HOSTNAME%/%$YEAR%/%$MONTH%/%$DAY%/news.crit:%HOSTNAME%:%$NOW%"
$template PerHostNewsErr,"<%= @log_dir %>/%HOSTNAME%/%$YEAR%/%$MONTH%/%$DAY%/news.err:%HOSTNAME%:%$NOW%"
$template PerHostNewsNotice,"<%= @log_dir %>/%HOSTNAME%/%$YEAR%/%$MONTH%/%$DAY%/news.notice:%HOSTNAME%:%$NOW%"
$template PerHostDebug,"<%= @log_dir %>/%HOSTNAME%/%$YEAR%/%$MONTH%/%$DAY%/debug:%HOSTNAME%:%$NOW%"
$template PerHostMessages,"<%= @log_dir %>/%HOSTNAME%/%$YEAR%/%$MONTH%/%$DAY%/messages:%HOSTNAME%:%$NOW%"

# Configuration for Apache
$template PerHostApacheAccess,"<%= @log_dir %>/%HOSTNAME%/%$YEAR%/%$MONTH%/%$DAY%/apache2/access:%SYSLOGTAG%%$NOW%;%msg:2:$%\n"
$template PerHostApacheError,"<%= @log_dir %>/%HOSTNAME%/%$YEAR%/%$MONTH%/%$DAY%/apache2/error:%SYSLOGTAG%%$NOW%;%msg:2:$%\n"

local6.info -?PerHostApacheAccess
& ~
local7.err -?PerHostApacheError
& ~

# Configuration for the mom (Map Display) webapp
$template PerHostMomAudit,"<%= @log_dir %>/%HOSTNAME%/%$YEAR%/%$MONTH%/%$DAY%/mom/%HOSTNAME%.audit.log.%$NOW%"
$template PerHostMomSecurity,"<%= @log_dir %>/%HOSTNAME%/%$YEAR%/%$MONTH%/%$DAY%/mom/%HOSTNAME%.security.log.%$NOW%"
$template PerHostMomExceptions,"<%= @log_dir %>/%HOSTNAME%/%$YEAR%/%$MONTH%/%$DAY%/mom/%HOSTNAME%.exceptions.log.%$NOW%"
$template PerHostMomError,"<%= @log_dir %>/%HOSTNAME%/%$YEAR%/%$MONTH%/%$DAY%/mom/%HOSTNAME%.error.log.%$NOW%"
$template PerHostMomApplication,"<%= @log_dir %>/%HOSTNAME%/%$YEAR%/%$MONTH%/%$DAY%/mom/%HOSTNAME%.application.log.%$NOW%"

# Configuration for the mom (Map Display) webapp
:msg, contains, "mom-audit.log"		?PerHostMomAudit	# Logs line
:msg, contains, "mom-audit.log"		~ 			# And discards
:msg, contains, "mom-security.log"	?PerHostMomSecurity
:msg, contains, "mom-security.log"	~
:msg, contains, "mom-exceptions.log"	?PerHostMomExceptions
:msg, contains, "mom-exceptions.log"	~
:msg, contains, "mom-error.log"		?PerHostMomError
:msg, contains, "mom-error.log"		~
:msg, contains, "mom-application.log"	?PerHostMomApplication
:msg, contains, "mom-application.log"	~

auth,authpriv.*         ?PerHostAuth
*.*;auth,authpriv.none  -?PerHostSyslog
cron.*                  ?PerHostCron
daemon.*                -?PerHostDaemon
kern.*                  -?PerHostKern
lpr.*                   -?PerHostLpr
mail.*                  -?PerHostMail
user.*                  -?PerHostUser

mail.info               -?PerHostMailInfo
mail.warn               ?PerHostMailWarn
mail.err                ?PerHostMailErr

news.crit               ?PerHostNewsCrit
news.err                ?PerHostNewsErr
news.notice             -?PerHostNewsNotice

*.=debug;\
  auth,authpriv.none;\
  news.none;mail.none   -?PerHostDebug

*.=info;*.=notice;*.=warn;\
  auth,authpriv.none;\
  cron,daemon.none;\
  mail,news.none        -?PerHostMessages

